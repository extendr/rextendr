<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Rust code in R packages • rextendr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Rust code in R packages">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rextendr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/package.html">Using Rust code in R packages</a></li>
    <li><a class="dropdown-item" href="../articles/rmarkdown.html">Using Rust code in R Markdown documents</a></li>
    <li><a class="dropdown-item" href="../articles/setting_up_rust.html">Setting up a Rust build environment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/extendr/rextendr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Rust code in R packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/extendr/rextendr/blob/main/vignettes/package.Rmd" class="external-link"><code>vignettes/package.Rmd</code></a></small>
      <div class="d-none name"><code>package.Rmd</code></div>
    </div>

    
    
<p>The rextendr package provides two utility functions for developing R
packages with Rust code using extendr:</p>
<ul>
<li>
<code><a href="../reference/use_extendr.html">rextendr::use_extendr()</a></code>: create the scaffolding to use
extendr, similar to <code><a href="https://usethis.r-lib.org/reference/use_cpp11.html" class="external-link">usethis::use_cpp11()</a></code>.</li>
<li>
<code><a href="../reference/document.html">rextendr::document()</a></code>: compile Rust code and generate
package documentation, similar to
<code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code>.</li>
</ul>
<p>One thing we want to emphasize here is that these functions are
needed solely for package development. An R package using extendr Rust
code doesn’t have to depend on or import the rextendr package, just like
R packages don’t usually add the devtools package to
<code>Depends</code> or <code>Imports</code> no matter how often the
package developers use the functions provided by devtools.</p>
<div class="section level2">
<h2 id="create-a-template-package">Create a template package<a class="anchor" aria-label="anchor" href="#create-a-template-package"></a>
</h2>
<p>Creating an R package with extendr is very easy with the rextendr
package.</p>
<p>First, create an empty R package. You can do this with
<code><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">usethis::create_package()</a></code>. Let’s pick
<code>myextendr</code> as the package name.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">create_package</a></span><span class="op">(</span><span class="st">"path/to/myextendr"</span><span class="op">)</span></span></code></pre></div>
<p>Then, execute <code><a href="../reference/use_extendr.html">rextendr::use_extendr()</a></code> inside the package
directory to create the scaffolding to use extendr.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rextendr</span><span class="fu">::</span><span class="fu"><a href="../reference/use_extendr.html">use_extendr</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✓ Creating src/rust/src.</span></span>
<span><span class="co">#&gt; ✓ Setting active project to 'path/to/myextendr'</span></span>
<span><span class="co">#&gt; ✓ Writing 'src/entrypoint.c'</span></span>
<span><span class="co">#&gt; ✓ Writing 'src/Makevars'</span></span>
<span><span class="co">#&gt; ✓ Writing 'src/Makevars.win'</span></span>
<span><span class="co">#&gt; ✓ Writing 'src/.gitignore'</span></span>
<span><span class="co">#&gt; ✓ Writing src/rust/Cargo.toml.</span></span>
<span><span class="co">#&gt; ✓ Writing 'src/rust/src/lib.rs'</span></span>
<span><span class="co">#&gt; ✓ Writing 'R/extendr-wrappers.R'</span></span>
<span><span class="co">#&gt; ✓ Finished configuring extendr for package myextendr.</span></span>
<span><span class="co">#&gt; • Please update the system requirement in DESCRIPTION file.</span></span>
<span><span class="co">#&gt; • Please run `rextendr::document()` for changes to take effect.</span></span></code></pre></div>
<p>For developers who use RStudio, we also provide a project template
that will call <code><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">usethis::create_package()</a></code> and
<code><a href="../reference/use_extendr.html">rextendr::use_extendr()</a></code> for you. This is done using
RStudio’s <strong>Create Project</strong> command, which you can find on
the global toolbar or in the File menu. Choose “New Directory” then
select “R package with extendr.” You can then fill out the details to
match your preferences.</p>
<p>Once you have the project directory setup, we strongly encourage you
to run <code><a href="../reference/rust_sitrep.html">rextendr::rust_sitrep()</a></code> in the console. This will
provide a detailed report of the current state of your Rust
infrastructure, along with some helpful advice about how to address any
issues that may arise.</p>
<p>Assuming we have a proper installation of Rust, we are just one step
away from calling Rust functions from R. As the message above says, we
need to run <code><a href="../reference/document.html">rextendr::document()</a></code>. But, before moving
forward, let’s look at the files added.</p>
</div>
<div class="section level2">
<h2 id="package-structure">Package structure<a class="anchor" aria-label="anchor" href="#package-structure"></a>
</h2>
<p>The following files have been added by
<code><a href="../reference/use_extendr.html">rextendr::use_extendr()</a></code>:</p>
<pre><code>.
├── R
│   └── extendr-wrappers.R
...
└── src
    ├── Makevars
    ├── Makevars.win
    ├── entrypoint.c
    └── rust
        ├── Cargo.toml
        └── src
            └── lib.rs</code></pre>
<ul>
<li>
<strong><code>R/extendr-wrappers.R</code></strong>: This file
contains auto-generated R functions from Rust code. We don’t modify this
file by hand.</li>
<li>
<strong><code>src/Makevars</code></strong>,
<strong><code>src/Makevars.win</code></strong>: These files hook
<code>cargo build</code> at the installation of the R package. In most
cases, we don’t edit these.</li>
<li>
<strong><code>src/entrypoint.c</code></strong>: This file is needed
to avoid the linker removing the static library. In 99.9% of cases, we
don’t edit this (except for changing the crate name).</li>
<li>
<strong><code>src/rust/</code></strong>: Rust code of a crate using
extendr-api. This is where we mainly write code.</li>
</ul>
<p>So, in short, what we should really look at is only these two
files:</p>
<div class="section level3">
<h3 id="srcrustcargo-toml">
<code>src/rust/Cargo.toml</code><a class="anchor" aria-label="anchor" href="#srcrustcargo-toml"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode toml"><code class="sourceCode toml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">[package]</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">'</span><span class="vs">myextendr</span><span class="st">'</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">'</span><span class="vs">0.1.0</span><span class="st">'</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="dt">edition</span> <span class="op">=</span> <span class="st">'</span><span class="vs">2021</span><span class="st">'</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="kw">[lib]</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="dt">crate-type</span> <span class="op">=</span> <span class="op">[</span> <span class="st">'</span><span class="vs">staticlib</span><span class="st">'</span> <span class="op">]</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="kw">[dependencies]</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="dt">extendr-api</span> <span class="op">=</span> <span class="st">'</span><span class="vs">*</span><span class="st">'</span></span></code></pre></div>
<p>The crate name is the same name as the R package’s name by default.
You can change this, but it might be a bit cumbersome to tweak other
files accordingly, so we recommend leaving this.</p>
<p>You will probably want to specify a concrete extendr version, for
example <code>extendr-api = '0.2'</code>. To try the development version
of the extendr, you can modify the last line to read</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode toml"><code class="sourceCode toml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dt">extendr-api</span> <span class="op">=</span> <span class="op">{ </span><span class="dt">git</span><span class="op"> =</span> <span class="st">'</span><span class="vs">https://github.com/extendr/extendr</span><span class="st">'</span><span class="op"> }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="srcrustsrclib-rs">
<code>src/rust/src/lib.rs</code><a class="anchor" aria-label="anchor" href="#srcrustsrclib-rs"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">use</span> <span class="pp">extendr_api::prelude::</span><span class="op">*;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">/// Return string `"Hello world!"` to R.</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">/// @export</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="at">#[</span>extendr<span class="at">]</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="kw">fn</span> hello_world() <span class="op">-&gt;</span> <span class="op">&amp;</span><span class="ot">'static</span> <span class="dt">str</span> <span class="op">{</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="st">"Hello world!"</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">// Macro to generate exports.</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">// This ensures exported functions are registered with R.</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">// See corresponding C code in `entrypoint.c`.</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="pp">extendr_module!</span> <span class="op">{</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    <span class="kw">mod</span> myextendr<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    <span class="kw">fn</span> hello_world;</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s explain this file line by line.</p>
<p>The first line, containing the <code>use</code> statement, declares
the commonly used extendr API functions to the Rust compiler.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">use</span> <span class="pp">extendr_api::prelude::</span><span class="op">*;</span></span></code></pre></div>
<p>Next, you may notice that <code>/</code> is repeated three times,
while the usual Rust comments require only two slashes (i.e.,
<code>//</code>). This is one of Rust’s “<a href="https://doc.rust-lang.org/reference/comments.html#doc-comments" class="external-link">doc
comment</a>” notation to generate the crate’s documentation. In extendr,
these lines are copied to the auto-generated R code as roxygen comments.
This is analogous to Rcpp/cpp11’s <code>//'</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">/// Return string `"Hello world!"` to R.</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">/// @export</span></span></code></pre></div>
<p>The next line is the core of extendr’s mechanism. If the function is
marked with this macro, the corresponding R function will be generated
automatically. This is analogous to Rcpp’s <code>[[Rcpp::export]]</code>
and cpp11’s <code>[[cpp11::register]]</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#[extendr]</span></span></code></pre></div>
<p>The last 3 lines are the macro for generating exports, as the comment
explains. If we implement another function than just
<code>hello_world</code>, it needs to be listed here as well as marking
it with <code>#[extendr]</code> macro.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">// Macro to generate exports.</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">// This ensures exported functions are registered with R.</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">// See corresponding C code in `entrypoint.c`.</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="pp">extendr_module!</span> <span class="op">{</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="kw">mod</span> myextendr<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="kw">fn</span> hello_world;</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="compile-and-use-the-package">Compile and use the package<a class="anchor" aria-label="anchor" href="#compile-and-use-the-package"></a>
</h2>
<div class="section level3">
<h3 id="compile">Compile<a class="anchor" aria-label="anchor" href="#compile"></a>
</h3>
<p>Compiling Rust code into R functions is as easy as executing this one
command:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rextendr</span><span class="fu">::</span><span class="fu"><a href="../reference/document.html">document</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✓ Saving changes in the open files.</span></span>
<span><span class="co">#&gt; ℹ Generating extendr wrapper functions for package: myextendr.</span></span>
<span><span class="co">#&gt; ! No library found at src/myextendr.so, recompilation is required.</span></span>
<span><span class="co">#&gt; Re-compiling myextendr</span></span>
<span><span class="co">#&gt; ─  installing *source* package ‘myextendr’ ... (347ms)</span></span>
<span><span class="co">#&gt;    ** using staged installation</span></span>
<span><span class="co">#&gt;    ** libs</span></span>
<span><span class="co">#&gt;    rm -Rf myextendr.so ./rust/target/release/libmyextendr.a entrypoint.o</span></span>
<span><span class="co">#&gt;    gcc -std=gnu99 -I"/usr/share/R/include" -DNDEBUG      -fpic  -g -O2 -fdebug-prefix-map=/build/r-base-tbZjLv/r-base-4.1.0=. #&gt; -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g  -UNDEBUG -Wall -pedantic -g -O0 #&gt; -fdiagnostics-color=always -c entrypoint.c -o entrypoint.o</span></span>
<span><span class="co">#&gt;    cargo build --lib --release --manifest-path=./rust/Cargo.toml</span></span>
<span><span class="co">#&gt;        Updating crates.io index</span></span>
<span><span class="co">#&gt;       Compiling proc-macro2 v1.0.27</span></span>
<span><span class="co">#&gt;       Compiling unicode-xid v0.2.2</span></span>
<span><span class="co">#&gt;       Compiling libR-sys v0.2.1</span></span>
<span><span class="co">#&gt;       Compiling syn v1.0.72</span></span>
<span><span class="co">#&gt;       Compiling extendr-engine v0.2.0</span></span>
<span><span class="co">#&gt;       Compiling lazy_static v1.4.0</span></span>
<span><span class="co">#&gt;       Compiling quote v1.0.9</span></span>
<span><span class="co">#&gt;       Compiling extendr-macros v0.2.0</span></span>
<span><span class="co">#&gt;       Compiling extendr-api v0.2.0</span></span>
<span><span class="co">#&gt;       Compiling myextendr v0.1.0 (path/to/myextendr/src/rust)</span></span>
<span><span class="co">#&gt;        Finished release [optimized] target(s) in 19.05s</span></span>
<span><span class="co">#&gt;    gcc -std=gnu99 -shared -L/usr/lib/R/lib -Wl,-Bsymbolic-functions -Wl,-z,relro -o myextendr.so entrypoint.o -L./rust/target/release #&gt; -lmyextendr -L/usr/lib/R/lib -lR</span></span>
<span><span class="co">#&gt;    installing to /tmp/RtmpfMcL08/devtools_install_e2d6351b843c/00LOCK-myextendr/00new/myextendr/libs</span></span>
<span><span class="co">#&gt;    ** checking absolute paths in shared objects and dynamic libraries</span></span>
<span><span class="co">#&gt; ─  DONE (myextendr)</span></span>
<span><span class="co">#&gt; ✓ Writing 'R/extendr-wrappers.R'.</span></span>
<span><span class="co">#&gt; ℹ Updating myextendr documentation</span></span>
<span><span class="co">#&gt; ℹ Loading myextendr</span></span>
<span><span class="co">#&gt; Writing NAMESPACE</span></span>
<span><span class="co">#&gt; Writing NAMESPACE</span></span>
<span><span class="co">#&gt; Writing hello_world.Rd</span></span></code></pre></div>
<p>You might wonder why compilation is triggered while the function name
is just <code><a href="../reference/document.html">document()</a></code>. Well, this is because the compilation
is actually needed to generate documentation and R wrapper code from the
Rust code. This is consistent with the behavior of
<code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code> for packages using C or C++.</p>
<p>By doing the above, the following files are updated or generated:</p>
<pre><code>.
...
├── NAMESPACE                       ----------(4)
├── R
│   └── extendr-wrappers.R          ----------(3)
├── man
│   └── hello_world.Rd              ----------(4)
└── src
    ├── myextendr.so          ----------(2)
    └── rust
        └── target
            └── release
                ├── libmyextendr.a   ---(1)
                ...</code></pre>
<ol style="list-style-type: decimal">
<li>
<strong><code>src/rust/target/release/libmyextendr.a</code></strong>
(the extension depends on the OS): This is the static library built from
Rust code. This will be then used for compiling the shared object
<code>myextendr.so</code>.</li>
<li>
<strong><code>src/myextendr.so</code></strong> (the extension
depends on the OS): This is the shared object that is actually called
from R.</li>
<li>
<strong><code>R/extendr-wrappers.R</code></strong>: The
auto-generated R functions, including roxygen comments, go into this
file. The roxygen comments are accordingly converted into Rd files and
<code>NAMESPACE</code>.</li>
<li>
<strong><code>man/</code></strong>,
<strong><code>NAMESPACE</code></strong>: These are generated from
roxygen comments.</li>
</ol>
</div>
<div class="section level3">
<h3 id="load-and-use">Load and use<a class="anchor" aria-label="anchor" href="#load-and-use"></a>
</h3>
<p>After running <code><a href="../reference/document.html">rextendr::document()</a></code>, we can just load the
package with <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all()</a></code> (or alternatively install
it and call with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code>) and then call the function we
have implemented in Rust.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">hello_world</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Hello world!"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="rust-code-vs-generated-r-code">Rust code vs generated R code<a class="anchor" aria-label="anchor" href="#rust-code-vs-generated-r-code"></a>
</h2>
<p>While we never edit the R wrapper code by hand, it might be good to
know what R code is generated from the Rust code. Let’s look at
<code>R/extendr-wrappers.R</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generated by extendr: Do not edit by hand</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># This file was created with the following call:</span></span>
<span><span class="co">#   .Call("wrap__make_myextendr_wrappers", use_symbols = TRUE, package_name = "myextendr")</span></span>
<span></span>
<span><span class="co">#' @docType package</span></span>
<span><span class="co">#' @usage NULL</span></span>
<span><span class="co">#' @useDynLib myextendr, .registration = TRUE</span></span>
<span><span class="cn">NULL</span></span>
<span></span>
<span><span class="co">#' Return string `"Hello world!"` to R.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello_world</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/CallExternal.html" class="external-link">.Call</a></span><span class="op">(</span><span class="va">wrap__hello_world</span><span class="op">)</span></span></code></pre></div>
<p>Here,
<code>.Call("wrap__make_myextendr_wrappers", use_symbols = ...</code> is
a function call that was executed by
<code><a href="../reference/document.html">rextendr::document()</a></code>.</p>
<p>A section of <code>@docType package</code> is needed to generate the
<code>useDynLib(myextendr, .registration = TRUE)</code> entry in
<code>NAMESPACE</code>.</p>
<p>The last section is for <code>hello_world()</code>. We can see the
roxygen comments are copied to here. As the Rust function
<code>hello_world()</code> has no arguments this R function also has no
arguments. If the function had arguments, such as</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="kw">fn</span> add(x<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> y<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">i32</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    x <span class="op">+</span> y</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>then the generated function wrapper also would have arguments:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/CallExternal.html" class="external-link">.Call</a></span><span class="op">(</span><span class="va">wrap__add</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="implement-a-new-rust-function">Implement a new Rust function<a class="anchor" aria-label="anchor" href="#implement-a-new-rust-function"></a>
</h2>
<p>Now that we have roughly figured out how extendr works, let’s
implement a new Rust function. The development flow would be:</p>
<ol style="list-style-type: decimal">
<li>Modify <code>src/rust/src/lib.rs</code>
</li>
<li>Run <code><a href="../reference/document.html">rextendr::document()</a></code>
</li>
<li>Run <code>devtools::load_all(".")</code> and test the function</li>
</ol>
<p>As an exercise, let’s add the <code>add(i32, i32)</code> function
from the previous subsection.</p>
<div class="section level3">
<h3 id="modify-srcrustsrclib-rs">1. Modify <code>src/rust/src/lib.rs</code><a class="anchor" aria-label="anchor" href="#modify-srcrustsrclib-rs"></a>
</h3>
<p>Add the function with <code>@export</code>, so it will get exported
from the generated R package. (Without this tag, the function would be
available internally for package programming but not externally to users
of the package.)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co">/// @export</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="at">#[</span>extendr<span class="at">]</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="kw">fn</span> add(x<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> y<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">i32</span> <span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    x <span class="op">+</span> y</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Don’t forget to add the function to <code>extendr_module!</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode rs"><code class="sourceCode rust"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="pp">extendr_module!</span> <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>    <span class="kw">mod</span> myextendr<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    <span class="kw">fn</span> hello_world;</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    fn add;</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-rextendrdocument">2. Run <code>rextendr::document()</code><a class="anchor" aria-label="anchor" href="#run-rextendrdocument"></a>
</h3>
<p>Just run this command:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rextendr</span><span class="fu">::</span><span class="fu"><a href="../reference/document.html">document</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-devtoolsload_all--and-test-the-function">3. Run <code>devtools::load_all(".")</code> and test the
function<a class="anchor" aria-label="anchor" href="#run-devtoolsload_all--and-test-the-function"></a>
</h3>
<p>Now you can load the package and call <code>add()</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add</span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claus O. Wilke, Andy Thomason, Mossa M. Reimert, Ilia Kosenkov, Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
