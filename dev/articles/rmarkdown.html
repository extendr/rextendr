<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Rust code in R Markdown documents • rextendr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Rust code in R Markdown documents">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rextendr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cran-compliance.html">CRAN compliant extendr packages</a></li>
    <li><a class="dropdown-item" href="../articles/package.html">Using Rust code in R packages</a></li>
    <li><a class="dropdown-item" href="../articles/rmarkdown.html">Using Rust code in R Markdown documents</a></li>
    <li><a class="dropdown-item" href="../articles/setting_up_rust.html">Setting up a Rust build environment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/extendr/rextendr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Rust code in R Markdown documents</h1>
                        <h4 data-toc-skip class="author">Claus O.
Wilke</h4>
            
            <h4 data-toc-skip class="date">2024-09-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/extendr/rextendr/blob/main/vignettes/rmarkdown.Rmd" class="external-link"><code>vignettes/rmarkdown.Rmd</code></a></small>
      <div class="d-none name"><code>rmarkdown.Rmd</code></div>
    </div>

    
    
<p>The rextendr package enables two new chunk types for knitr,
<code>extendr</code> and <code>extendrsrc</code>. The former can be used
to evaluate individual Rust statements while the latter can be used to
define Rust functions and export them to R. To use either chunk type,
you need to first load the rextendr package in a regular R chunk. You
would normally do this in a hidden setup chunk at the top of your R
Markdown document.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://extendr.github.io/rextendr/" class="external-link">rextendr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="evaluating-rust-statements">Evaluating Rust statements<a class="anchor" aria-label="anchor" href="#evaluating-rust-statements"></a>
</h2>
<p>Chunks of type <code>extendr</code> evaluate a block of Rust
statements. The value of the last statement can be returned to R and
will be printed as chunk output. For example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="in">```{extendr}</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="in">rprintln!("Hello from Rust!");</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="in">let x = 5;</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="in">let y = 7;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="in">let z = x*y;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="in">z</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>This chunk will look in the knitted document as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="pp">rprintln!</span>(<span class="st">"Hello from Rust!"</span>)<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">let</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="kw">let</span> y <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="kw">let</span> z <span class="op">=</span> x<span class="op">*</span>y<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>z</span></code></pre></div>
<pre><code><span><span class="co">## Hello from Rust!</span></span>
<span><span class="co">## [1] 35</span></span></code></pre>
<p>In the background, the <code>extendr</code> knit engine casts the
Rust integer variable into type <code>Result&lt;Robj&gt;</code> and
returns its value to R. Notice the lack of a semicolon (<code>;</code>)
at the end of this line, to indicate that you want to return a value.
You can also write code that doesn’t return any result to R. In this
case, the last line would end in a semicolon, as in this example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">let</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="kw">let</span> y <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="kw">let</span> z <span class="op">=</span> x<span class="op">*</span>y<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="pp">rprintln!</span>(<span class="st">"{}*{} = {}"</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> z)<span class="op">;</span></span></code></pre></div>
<pre><code><span><span class="co">## 5*7 = 35</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="accessing-r-values-from-rust">Accessing R values from Rust<a class="anchor" aria-label="anchor" href="#accessing-r-values-from-rust"></a>
</h2>
<p>It is possible to access variables defined in R from Rust. Let’s
define two R variables, a numeric and a string:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5.3</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"hello"</span></span></code></pre></div>
<p>We can read these variables from Rust using the <code>R!()</code>
macro. Unfortunately, it takes a bit of error checking and
type-converting to get these into native Rust values. This is the case
because things could go wrong at each step. We’re handling the errors
with <code>?</code>. For example, <code>R!()</code> calls the R
interpreter and it could generate an error. And even if it returns a
value, we’re not guaranteed that the value can be coerced into a real
value or a string. However, <code>as_real()</code> and
<code>as_str()</code> don’t return errors, they return options, so we
need to turn the <code>None</code> option into an error via
<code>ok_or()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">let</span> x<span class="op">:</span><span class="dt">f64</span> <span class="op">=</span> <span class="pp">R!</span>(x)<span class="op">?</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="op">.</span>as_real()</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="op">.</span>ok_or(<span class="st">"expected a real"</span>)<span class="op">?;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="kw">let</span> y<span class="op">:</span><span class="dt">String</span> <span class="op">=</span> <span class="pp">R!</span>(y)<span class="op">?</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="op">.</span>as_str()</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="op">.</span>ok_or(<span class="st">"expected a string reference"</span>)<span class="op">?</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="pp">rprintln!</span>(<span class="st">"The value of x: {}</span><span class="sc">\n</span><span class="st">The value of y: {}"</span><span class="op">,</span> x<span class="op">,</span> y)<span class="op">;</span></span></code></pre></div>
<pre><code><span><span class="co">## The value of x: 5.3</span></span>
<span><span class="co">## The value of y: hello</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="chaining-chunks-together">Chaining chunks together<a class="anchor" aria-label="anchor" href="#chaining-chunks-together"></a>
</h2>
<p>We may sometimes want to break a block of Rust code into separate
Markdown chunks but treat them as one compile unit. We can do so by
including the code from one chunk into the compile unit of another, by
specifying a <code>preamble</code> chunk option. This option takes a
character vector of chunk names, which get included into the compile
unit in the order provided.</p>
<p>Consider this example Markdown code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>Define variable <span class="in">`x`</span>:</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="in">```{extendr chunk_x, eval = FALSE}</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="in">let x = 1;</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>Define variable <span class="in">`y`</span>:</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="in">```{extendr chunk_y, eval = FALSE}</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="in">let y = 2;</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>Print:</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="in">```{extendr out, preamble = c("chunk_x", "chunk_y")}</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="in">rprintln!("x = {}, y = {}", x, y);</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>It produces the following output.</p>
<p>Define variable <code>x</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">let</span> x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span></code></pre></div>
<p>Define variable <code>y</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">let</span> y <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span></code></pre></div>
<p>Print:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="pp">rprintln!</span>(<span class="st">"x = {}, y = {}"</span><span class="op">,</span> x<span class="op">,</span> y)<span class="op">;</span></span></code></pre></div>
<pre><code><span><span class="co">## x = 1, y = 2</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="exporting-rust-functions-or-objects-to-r">Exporting Rust functions or objects to R<a class="anchor" aria-label="anchor" href="#exporting-rust-functions-or-objects-to-r"></a>
</h2>
<p>The chunk type <code>extendrsrc</code> compiles Rust functions and
objects and registers them with R to be called later. For example,
consider this code chunk. It creates R functions <code>hello()</code>
and <code>foo()</code>, as well as a class called
<code>Counter</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="in">```{extendrsrc}</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="in">#[extendr]</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="in">fn hello() -&gt; &amp;'static str {</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="in">    "Hello from Rust!"</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="in">#[extendr]</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="in">fn foo(a: &amp;str, b: i64) {</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="in">    rprintln!("Data sent to Rust: {}, {}", a, b);</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="in">struct Counter {</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="in">    n: i32,</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="in">#[extendr]</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="in">impl Counter {</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="in">    fn new() -&gt; Self {</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="in">        Self { n: 0 }</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="in">    fn increment(&amp;mut self) {</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="in">        self.n += 1;</span></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="in">    fn get(&amp;self) -&gt; i32 {</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a><span class="in">        self.n</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>The only output the chunk itself creates is the Rust source code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="at">#[</span>extendr<span class="at">]</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="kw">fn</span> hello() <span class="op">-&gt;</span> <span class="op">&amp;</span><span class="ot">'static</span> <span class="dt">str</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    <span class="st">"Hello from Rust!"</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="at">#[</span>extendr<span class="at">]</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="kw">fn</span> foo(a<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> b<span class="op">:</span> <span class="dt">i64</span>) <span class="op">{</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    <span class="pp">rprintln!</span>(<span class="st">"Data sent to Rust: {}, {}"</span><span class="op">,</span> a<span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="kw">struct</span> Counter <span class="op">{</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>    n<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="at">#[</span>extendr<span class="at">]</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="kw">impl</span> Counter <span class="op">{</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>    <span class="kw">fn</span> new() <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>        <span class="dt">Self</span> <span class="op">{</span> n<span class="op">:</span> <span class="dv">0</span> <span class="op">}</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>    </span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>    <span class="kw">fn</span> increment(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>n <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>    </span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>    <span class="kw">fn</span> get(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">i32</span> <span class="op">{</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>n</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>However, now we can call the functions <code>hello()</code> and
<code>foo()</code> from R and use the <code>Counter</code> object:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">hello</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">out</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Hello from Rust!"</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">foo</span><span class="op">(</span><span class="va">out</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data sent to Rust: Hello from Rust!, 16</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">Counter</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="fu">increment</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">increment</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<p>If your code requires external crates, you can set dependencies via
the <code>engine.opts</code> chunk option, like so:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>``<span class="in">`{extendrsrc engine.opts = list(dependencies = list(`</span>pulldown-cmark` = "0.8"))}</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>use pulldown_cmark::{Parser, Options, html};</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>#<span class="co">[</span><span class="ot">extendr</span><span class="co">]</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>fn md_to_html(input: &amp;str) -&gt; String {</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    let mut options = Options::empty();</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    options.insert(Options::ENABLE_TABLES);</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>    let parser = Parser::new_ext(input, options);</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>    let mut output = String::new();</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>    html::push_html(&amp;mut output, parser);</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>    output</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>}</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>As before, the Rust code chunk just outputs the source:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="kw">use</span> <span class="pp">pulldown_cmark::</span><span class="op">{</span>Parser<span class="op">,</span> Options<span class="op">,</span> html<span class="op">};</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="at">#[</span>extendr<span class="at">]</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="kw">fn</span> md_to_html(input<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> options <span class="op">=</span> <span class="pp">Options::</span>empty()<span class="op">;</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    options<span class="op">.</span>insert(<span class="pp">Options::</span>ENABLE_TABLES)<span class="op">;</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>    <span class="kw">let</span> parser <span class="op">=</span> <span class="pp">Parser::</span>new_ext(input<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> output <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>    <span class="pp">html::</span>push_html(<span class="op">&amp;</span><span class="kw">mut</span> output<span class="op">,</span> parser)<span class="op">;</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>    output</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And the generated functions can be used from R:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">md_text</span> <span class="op">&lt;-</span> <span class="st">"# The story of the fox</span></span>
<span><span class="st">The quick brown fox **jumps over** the lazy dog.</span></span>
<span><span class="st">The quick *brown fox* jumps over the lazy dog."</span></span>
<span></span>
<span><span class="fu">md_to_html</span><span class="op">(</span><span class="va">md_text</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;h1&gt;The story of the fox&lt;/h1&gt;\n&lt;p&gt;The quick brown fox &lt;strong&gt;jumps over&lt;/strong&gt; the lazy dog.\nThe quick &lt;em&gt;brown fox&lt;/em&gt; jumps over the lazy dog.&lt;/p&gt;\n"</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claus O. Wilke, Andy Thomason, Mossa M. Reimert, Ilia Kosenkov, Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
